<html>
<head>
  <title>Swag</title>
  <script src="http://fb.me/react-0.12.2.js"></script>
  <script src="http://fb.me/JSXTransformer-0.12.2.js"></script>
  <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.min.css" />
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.ie.min.css" />
</head>
<body>
  <div id="content"></div>
  <script type="text/jsx">
    var TextInput = React.createClass({
      getInitialState: function() {
        return {value: null};
      },
      handleChange: function(e){
        // use e.target.value if doing something with value
        // this.setState({value: e.target.value});
        this.props.updateProductName(e.target.value);
      },
      render: function() {
        return (
          <div className="form-group">
            <label htmlFor="productName">1. Enter the name of your product</label>
            <input type="text" className="form-control" placeholder="Product name" onChange={this.handleChange} />
          </div>
        )
      }
    });

    var SwagTypeSelector = React.createClass({
      getInitialState: function() {
        return {
          itemRows: [
            [ {name: "Flag", desc: "The original swag flag", minHeight: "41px;", width: "25%"},
              {name: "Flag and Text", desc: "The original swag flag", sampleImage: "flag_text.svg", width: "100%"}
            ],
            [
              {name: "Long banner", desc: "Takes up an entire row", sampleImage: "dark_badge.svg", width: "100%"},
              {name: "Long banner", desc: "Takes up an entire row", sampleImage: "light_badge.svg", width: "100%"}
            ]
          ]
        }
      },
      renderRow: function(itemRow) {
        var colwidth = 12/itemRow.length;
        var defaultImage = "https://treasure.assembly.com/assets/flag-36b9a010cd4cc717cc842a5add1a5f65.svg"

        var itemNodes = itemRow.map(function(item, i) {
          return (
            <div className={"col-md-" + colwidth} key={i}>
              <div className="thumbnail">
                <h5 style={{margin: "10px"}}>{item.name}</h5>
                <div style={{margin: item.margin || "15px 5px 0px", textAlign: "center", minHeight: item.minHeight}}>
                  <img width={item.width || "40px"} src={item.sampleImage || defaultImage} />
                </div>
                {item.desc ? (<div className="caption">
                  <p className="help-block">{item.desc}</p>
                  </div>) : null }
              </div>
            </div>
          );
        });

        return (
          <div>
            {itemNodes}
          </div>
        )
      },
      render: function() {
        return (
          <div>
            <div className="form-group">
              <label forHtml="swagTypes">2. Select a badge type</label>
            </div>
            {this.state.itemRows.map(function(itemRow, i) {
              return (
                <div className="row" key={i}>
                  {this.renderRow.bind(this, itemRow)()}
                </div>
              );
            }, this)}
          </div>
        );
      }
    });

    var CodeBox = React.createClass({
      getInitialState: function() {
        return {
          productName: "productName",
          productSlug: "PRODUCT"
        }
      },
      handleFocus: function(e) {
        e.target.select();
      },
      handleMouseUp: function(e) {
        e.preventDefault();
      },
      componentWillReceiveProps: function(newProps) {
        this.setState({
            productName: newProps.productName,
            productSlug: this.slugifiedName(newProps.productName)
          });
      },
      slugifiedName: function(nameString) {
        return nameString.toString().toLowerCase()
          .replace(/\s+/g, '-')           // Replace spaces with -
          .replace(/[^\w\-]+/g, '')       // Remove all non-word chars
          .replace(/\-\-+/g, '-')         // Replace multiple - with single -
          .replace(/^-+/, '')             // Trim - from start of text
          .replace(/-+$/, '');            // Trim - from end of text
      },
      render: function() {

        var codeString = "<a href='https://assembly.com/" + this.state.productSlug + "?utm_campaign=assemblage&utm_source=" + this.state.productSlug + "&utm_medium=flair_widget&utm_type=TYPE'>Built on Assembly</a>"

        return (
          <div className="form-group">
            <label htmlFor="codeBox">Code</label>
            <textarea type="textarea" className="form-control" onFocusCapture={this.handleFocus} onMouseUpCapture={this.handleMouseUp} readOnly value={codeString} rows="4"></textarea>
          </div>
        )
      }
    });

    var Swag = React.createClass({
      getInitialState: function() {
        return {productName: null};
      },
      handleInputTextUpdate: function(value) {
        this.setState({productName: value});
      },
      render: function() {
        return (
          <div className="container">
            <div className="row">
              <div className="col-sm-6 col-sm-offset-3">
                <h2>Assemblage</h2>
                <TextInput updateProductName={this.handleInputTextUpdate} />
                <SwagTypeSelector />
                <CodeBox productName={this.state.productName} />
              </div>
            </div>
          </div>
        )
      }
    });

    React.render(
      <Swag />,
      document.getElementById('widget-content')
    )
  </script>

<div id="widget-content"></div>




</body>
</html>
